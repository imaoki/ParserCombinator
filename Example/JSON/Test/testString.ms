/*! Â© 2022 imaoki | MIT License | https://github.com/imaoki */
(
  -- clearListener()

  local nowTime = (DotNetClass "System.DateTime").Now.ToString "HH:mm:ss"
  local sw = DotNetObject "System.Diagnostics.Stopwatch"

  local currentFile = getSourceFileName()
  local pathUtility = ::std.PathUtilityStruct currentFile

  local actual
  local expected
  local testDef
  local testObj

  format "[run %]@\"%\"\n" nowTime currentFile
  /* Setup Start ------------------------------------------------------------ */
  fileIn (pathUtility.GetFullPath @"..\..\..\definitionPool.ms")
  local failure = (::parserCombinatorDefinitionPool[@"Model\Failure.ms"])()
  local notCollect = (::parserCombinatorDefinitionPool[@"Model\NotCollect.ms"])()

  testDef = fileIn (pathUtility.GetFullPath @"..\String.ms")
  testObj = testDef ShowError:false
  /* Setup End -------------------------------------------------------------- */
  sw.Start()
  /* Test Start ------------------------------------------------------------- */
  /* Parse */
  -- ç©ºã‚³ãƒ¼ãƒ‰
  actual = ::TestValueStruct (testObj.Parse "")
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- å¼•ç”¨ç¬¦ç„¡ã—
  actual = ::TestValueStruct (testObj.Parse "foobar")
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- å˜ä¸€å¼•ç”¨ç¬¦
  actual = ::TestValueStruct (testObj.Parse "'foobar'")
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ã„ãªã„ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ–‡å­—ï¼ˆãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"hoge\\piyo\"")
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ã„ãªã„ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ–‡å­—ï¼ˆã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"hoge/piyo\"")
  expected = ::TestValueStruct "hoge/piyo"
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ã„ãªã„åˆ¶å¾¡æ–‡å­—ï¼ˆBackspaceï¼‰
  actual = ::TestValueStruct (testObj.Parse ("\"hoge" + Bit.IntAsChar 8 + "piyo\""))
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ã„ãªã„åˆ¶å¾¡æ–‡å­—ï¼ˆForm Feedï¼‰
  actual = ::TestValueStruct (testObj.Parse ("\"hoge" + Bit.IntAsChar 12 + "piyo\""))
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ã„ãªã„åˆ¶å¾¡æ–‡å­—ï¼ˆLine Feedï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"hoge\npiyo\"")
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ã„ãªã„åˆ¶å¾¡æ–‡å­—ï¼ˆCarriage Returnï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"hoge\rpiyo\"")
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ã„ãªã„åˆ¶å¾¡æ–‡å­—ï¼ˆHorizontal Tabulationï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"hoge\tpiyo\"")
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- äºŒé‡å¼•ç”¨ç¬¦é–‰ã˜å¿˜ã‚Œ
  actual = ::TestValueStruct (testObj.Parse "\"foobar")
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- äºŒé‡å¼•ç”¨ç¬¦
  actual = ::TestValueStruct (testObj.Parse "\"foobar\"")
  -- actual.Dump()
  expected = ::TestValueStruct "foobar"
  assert (actual.Equals expected == true)
  -- äºŒé‡å¼•ç”¨ç¬¦ï¼ˆç©ºæ–‡å­—åˆ—ï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\"")
  expected = ::TestValueStruct ""
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãŸã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ–‡å­—ï¼ˆå¼•ç”¨ç¬¦ï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\\\"\"")
  expected = ::TestValueStruct "\""
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãŸã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ–‡å­—ï¼ˆãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\\\\\"")
  expected = ::TestValueStruct "\\"
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãŸã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ–‡å­—ï¼ˆã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\\/\"")
  expected = ::TestValueStruct "/"
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãŸåˆ¶å¾¡æ–‡å­—ï¼ˆBackspaceï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\\b\"")
  expected = ::TestValueStruct "\b"
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãŸåˆ¶å¾¡æ–‡å­—ï¼ˆForm Feedï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\\f\"")
  expected = ::TestValueStruct "\f"
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãŸåˆ¶å¾¡æ–‡å­—ï¼ˆLine Feedï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\\n\"")
  expected = ::TestValueStruct "\n"
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãŸåˆ¶å¾¡æ–‡å­—ï¼ˆCarriage Returnï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\\r\"")
  expected = ::TestValueStruct "\r"
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãŸåˆ¶å¾¡æ–‡å­—ï¼ˆHorizontal Tabulationï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\\t\"")
  expected = ::TestValueStruct "\t"
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãŸåˆ¶å¾¡æ–‡å­—ï¼ˆå…¨ã¦ï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\\\"\\\\\\/\\b\\f\\n\\r\\t\"")
  expected = ::TestValueStruct "\"\\/\b\f\n\r\t"
  assert (actual.Equals expected == true)
  ä¸å®Œå…¨ãª16é€²æ•°ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—ï¼ˆå­—æ•°ä¸è¶³ï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\\u002\"")
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- ä¸å®Œå…¨ãª16é€²æ•°ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—ï¼ˆç¯„å›²å¤–ã®æ–‡å­—ï¼‰
  actual = ::TestValueStruct (testObj.Parse "\"\\u002z\"")
  expected = ::TestValueStruct failure
  assert (actual.Equals expected == true)
  -- ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã¦ã„ãªã„ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãŸ16é€²æ•°ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—
  actual = ::TestValueStruct (testObj.Parse "\"[/\\/\\u002F\\u002f]\"")
  expected = ::TestValueStruct "[////]"
  assert (actual.Equals expected == true)
  -- ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢
  actual = ::TestValueStruct (testObj.Parse "\"\\ud83c\\udf63\"")
  expected = ::TestValueStruct "ğŸ£"
  assert (actual.Equals expected == true)
  /* Test End --------------------------------------------------------------- */
  sw.Stop()
  /* Teardown Start --------------------------------------------------------- */
  /* Teardown End ----------------------------------------------------------- */
  format "[end %]%ms\n" nowTime (sw.ElapsedMilliseconds as Integer)
  ok
)
